{% extends "base_generic.html" %}

{% block title %}<title>Test3 page</title>{% endblock %}

{% block content %}
<form action="/test3" method="post">
  {% csrf_token %}
  {{ form }}
  <input type="submit" value="Submit">
</form>

{% comment %}
<ul>
  {% for data in values %}
    <li>{% load tz %}{% localtime on %}Time : {{ data.date }}{% endlocaltime %} max: {{ data.max_reading }} min: {{ data.min_reading }}</li>
  {% endfor %}
</ul>
{% endcomment %}

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {'packages':['bar']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
    var data = new google.visualization.DataTable();
    data.addColumn('datetime', 'Time');
    data.addColumn('number', 'Max');
    data.addColumn('number', 'Min')
    {% if values %}
    {% for x in values %}
      var row =  [new Date('{{x.date.isoformat}}'),{{x.max_reading}},{{x.min_reading}}];
      data.addRows([row]);
    {% endfor %}
    {% else %}
      data.addRows([[new Date(0),1,1]]);
    {% endif %}
    var options = {
      chart: {
        title: 'Readings recorded'
      },
      width: 1000,
      height: 500,
    };
    var chart = new google.charts.Bar(document.getElementById('bar_chart'));
    chart.draw(data, google.charts.Bar.convertOptions(options));
  }
</script>
<div id="bar_chart"></div>
{% endblock %}
